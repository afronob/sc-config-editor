<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upload Statistiques - Step by Step Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-title {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .iframe-container {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            height: 600px;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .instructions {
            background: #e8f4f8;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin-bottom: 20px;
        }
        
        .test-button {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .expected-result {
            background: #f0f8e8;
            padding: 15px;
            border-left: 4px solid #4CAF50;
            margin-top: 20px;
        }
        
        .expected-result h4 {
            color: #2e7d32;
            margin-top: 0;
        }
        
        .result-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">üß™ Test des Statistiques XML - √âtape 1</h1>
        
        <div class="instructions">
            <h3>üìã Instructions du Test</h3>
            <ol>
                <li>Cliquez sur "D√©marrer le Test" ci-dessous</li>
                <li>Dans l'interface qui s'ouvre, uploadez le fichier <code>test_config.xml</code></li>
                <li>V√©rifiez que les statistiques apparaissent apr√®s l'upload</li>
                <li>Confirmez que les informations correspondent aux attentes</li>
            </ol>
        </div>
        
        <a href="step_by_step_handler.php?step=1" class="test-button" target="test-frame">
            üöÄ D√©marrer le Test de l'√âtape 1
        </a>
        
        <a href="javascript:resetSession()" class="test-button">
            üîÑ Reset Session
        </a>
        
        <a href="javascript:window.location.reload()" class="test-button">
            üîÉ Recharger la Page
        </a>
    </div>
    
    <div class="test-container">
        <h2>üñºÔ∏è Interface de Test</h2>
        <div class="iframe-container">
            <iframe name="test-frame" src="step_by_step_handler.php?step=1"></iframe>
        </div>
    </div>
    
    <div class="expected-result">
        <h4>‚úÖ R√©sultats Attendus Apr√®s Upload de test_config.xml</h4>
        <div class="result-item">
            <strong>üìÑ Nom du fichier:</strong> test_config.xml
        </div>
        <div class="result-item">
            <strong>üéØ Actions trouv√©es:</strong> 10
        </div>
        <div class="result-item">
            <strong>‚öôÔ∏è Actions configur√©es:</strong> 6
        </div>
        <div class="result-item">
            <strong>üìä Pourcentage configur√©:</strong> 60%
        </div>
        <div class="result-item">
            <strong>üîó Lien vers √©tape 2:</strong> "Continuer vers l'√©tape 2 ‚Üí"
        </div>
    </div>
    
    <div class="test-container">
        <h3>üõ†Ô∏è Tests Additionnels</h3>
        <a href="javascript:testDifferentFile()" class="test-button">
            üìÇ Tester avec un autre fichier XML
        </a>
        <a href="javascript:testDirectStep2()" class="test-button">
            ‚û°Ô∏è Acc√®s direct √âtape 2
        </a>
        <a href="javascript:checkSessionData()" class="test-button">
            üíæ V√©rifier les donn√©es de session
        </a>
    </div>
    
    <script>
        function resetSession() {
            const iframe = document.querySelector('iframe[name="test-frame"]');
            iframe.src = 'step_by_step_handler.php?action=restart';
            setTimeout(() => {
                iframe.src = 'step_by_step_handler.php?step=1';
            }, 1000);
            alert('Session r√©initialis√©e. L\'interface va se recharger.');
        }
        
        function testDifferentFile() {
            alert('Pour ce test, cr√©ez un autre fichier XML avec un nombre diff√©rent d\'actions et uploadez-le.');
        }
        
        function testDirectStep2() {
            const iframe = document.querySelector('iframe[name="test-frame"]');
            iframe.src = 'step_by_step_handler.php?step=2';
        }
        
        function checkSessionData() {
            // Ouvrir une nouvelle fen√™tre pour v√©rifier les donn√©es de session
            window.open('test_statistiques_session.php', '_blank', 'width=800,height=600');
        }
        
        // V√©rification automatique toutes les 5 secondes
        setInterval(() => {
            const iframe = document.querySelector('iframe[name="test-frame"]');
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const statsSection = iframeDoc.querySelector('.file-uploaded-info');
                
                if (statsSection) {
                    console.log('‚úÖ Section des statistiques d√©tect√©e !');
                    
                    const fileName = iframeDoc.querySelector('.file-uploaded-info strong:contains("Nom du fichier")');
                    const actionsTotal = iframeDoc.querySelector('.file-uploaded-info strong:contains("Actions trouv√©es")');
                    const actionsUsed = iframeDoc.querySelector('.file-uploaded-info strong:contains("Actions configur√©es")');
                    
                    if (fileName) console.log('‚úÖ Nom du fichier affich√©');
                    if (actionsTotal) console.log('‚úÖ Actions totales affich√©es');
                    if (actionsUsed) console.log('‚úÖ Actions utilis√©es affich√©es');
                } else {
                    console.log('‚ÑπÔ∏è En attente des statistiques...');
                }
            } catch (e) {
                // Erreur CORS - normal quand l'iframe charge une autre page
            }
        }, 5000);
    </script>
</body>
</html>
