<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - D√©tection Saitek X-56</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .test-success { background: #d4edda; border: 1px solid #c3e6cb; }
        .test-error { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>üéÆ Test Final - D√©tection Saitek X-56</h1>
    
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(title, success, message, data = null) {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'test-success' : 'test-error'}`;
            div.innerHTML = `
                <h3>${success ? '‚úÖ' : '‚ùå'} ${title}</h3>
                <p>${message}</p>
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        // Simuler un p√©riph√©rique Saitek X-56
        const saitekDevice = {
            vendorId: 0x0738,  // 1848 en d√©cimal
            productId: 0xa221  // 41505 en d√©cimal
        };
        
        // Fonction isDeviceKnown simplifi√©e (bas√©e sur le code original)
        function isDeviceKnown(device, devicesData) {
            if (!devicesData || !Array.isArray(devicesData)) {
                return false;
            }
            
            const vendorHex = '0x' + device.vendorId.toString(16).padStart(4, '0');
            const productHex = '0x' + device.productId.toString(16).padStart(4, '0');
            
            return devicesData.some(d => 
                d.vendor_id === vendorHex && d.product_id === productHex
            );
        }
        
        // Test de l'endpoint
        fetch('/get_devices_data.php')
            .then(response => response.json())
            .then(data => {
                addResult(
                    'Chargement des donn√©es de p√©riph√©riques',
                    true,
                    `${data.length} p√©riph√©riques charg√©s avec succ√®s`,
                    data.slice(0, 2) // Montrer seulement les 2 premiers
                );
                
                // V√©rifier la pr√©sence du Saitek
                const saitekInData = data.find(d => 
                    d.vendor_id === '0x0738' && d.product_id === '0xa221'
                );
                
                if (saitekInData) {
                    addResult(
                        'Pr√©sence des donn√©es Saitek X-56',
                        true,
                        'Le Saitek X-56 est pr√©sent dans les donn√©es',
                        saitekInData
                    );
                    
                    // Test de d√©tection
                    const isKnown = isDeviceKnown(saitekDevice, data);
                    
                    addResult(
                        'Test de d√©tection du Saitek X-56',
                        isKnown,
                        isKnown ? 
                            'Le Saitek X-56 est correctement d√©tect√© comme CONNU !' :
                            'ERREUR: Le Saitek X-56 est encore d√©tect√© comme inconnu',
                        {
                            device: saitekDevice,
                            deviceVendorHex: '0x' + saitekDevice.vendorId.toString(16).padStart(4, '0'),
                            deviceProductHex: '0x' + saitekDevice.productId.toString(16).padStart(4, '0'),
                            matchFound: isKnown
                        }
                    );
                    
                } else {
                    addResult(
                        'Pr√©sence des donn√©es Saitek X-56',
                        false,
                        'Le Saitek X-56 est ABSENT des donn√©es charg√©es'
                    );
                }
                
                // Test avec un p√©riph√©rique inconnu pour valider la logique
                const unknownDevice = { vendorId: 0x9999, productId: 0x9999 };
                const unknownIsKnown = isDeviceKnown(unknownDevice, data);
                
                addResult(
                    'Test de contr√¥le (p√©riph√©rique inconnu)',
                    !unknownIsKnown,
                    unknownIsKnown ? 
                        'ERREUR: Un p√©riph√©rique inconnu est d√©tect√© comme connu' :
                        'OK: Un p√©riph√©rique inconnu est correctement d√©tect√© comme inconnu'
                );
                
            })
            .catch(error => {
                addResult(
                    'Chargement des donn√©es de p√©riph√©riques',
                    false,
                    'Erreur lors du chargement: ' + error.message
                );
            });
    </script>
</body>
</html>
